function GridController(e,t,r,n,o){"use strict";function a(e){var t=[],a=[],i=[];return Array.isArray(e)&&s.autoColumn!==!1&&e.forEach(function(e){Object.keys(e).forEach(function(r){if(e.hasOwnProperty(r)&&-1===a.indexOf(r)&&"$$hashKey"!==r){var n={};n[s.columnKey]=r,n[s.columnName]=r,t.push(n),a.push(r)}})}),s.state&&Array.isArray(s.state.gridColumns)&&s.state.gridColumns.forEach(function(e){"$$hashKey"!==e[s.columnKey]&&(e.overrideTemplate&&n(e.overrideTemplate).then(function(n){var a=o(n);e.override=function(e,n,o){var l,u,c=s.data.indexOf(o),d=t.length-1,m=(s.state.page-1)*s.state.perPage+c;return i[n[s.columnKey]]&&i[n[s.columnKey]][c]?i[n[s.columnKey]][c]:(l=r.$new(),l.$index=m+e,angular.extend(l,{$colIndex:d,$rowIndex:m,$index:m,cell:e,column:n,row:o}),u=a(l),i[n[s.columnKey]]||(i[n[s.columnKey]]=[]),i[n[s.columnKey]][c]=u,u)}}),-1===a.indexOf(e[s.columnKey])?(t.push(e),a.push(e[s.columnKey])):t.forEach(function(t){t[s.columnKey]===e[s.columnKey]&&Object.keys(e).forEach(function(r){t[r]=e[r]})}))}),t}function i(){var e=s.pagination!==!0&&void 0!==s.pagination?s.pagination:20;s.state=s.state||{sort:void 0,sortDirection:void 0,page:1,perPage:s.pagination!==!1?e:0,gridColumns:[],refresh:!1},s.columnKey=s.columnKey||"name",s.columnName=s.columnName||"header",s.api={refresh:function(){t.log("refresh"),s.getData({state:s.state})}}}var s=this;r.Parent=r.$parent,e(function(){i()}),s.isSortable=function(e){return void 0===e.sortable?!0:e.sortable},s.getValue=function(e,t,r){var n;return n=t.override?t.override(e[t[s.columnKey]],t,e,r):e[t[s.columnKey]]},s.sort=function(e){(void 0===e.sortable||e.sortable)&&(s.state.sort===e[s.columnKey]?"DESC"===s.state.sortDirection?s.state.sortDirection="ASC":(s.state.sort=void 0,s.state.sortDirection=void 0):(s.state.sort=e[s.columnKey],s.state.sortDirection="DESC"))},r.$watch("Grid.state",function(){void 0!==s.state&&s.getData({state:s.state})},!0),r.$watch("Grid.data",function(){s.data=s.data||[],s.columnDefinition=a(s.data),s.rows=s.data},!0)}function NavbarController(e,t,r,n){"use strict";var o=this;o.isActive=function(e){return t.includes(e.activeState||e.name)},n.localStorage&&(o.accountName=n.localStorage.getItem("registeredAccount"),o.accountName&&(o.registered=!0)),o.undoStorage=function(){n.localStorage&&(n.localStorage.setItem("registeredAccount",void 0),o.accountName=void 0,o.registered=!1)},o.registerAccount=function(e){r.get("http://ssf.poeladder.com/signup/"+e).then(function(){o.registered=!0,n.localStorage&&n.localStorage.setItem("registeredAccount",e)})},o.ModuleStates=e}function StatusLightController(){var e=this,t={unknown:"#eee",ok:"#5cb85c",notice:"#feff78",warning:"#f0ad4e",danger:"#d9534f"};e.style={"background-color":t[e.status]||"transparent"}}function ModuleStatesProvider(e){"use strict";var t=[],r=[];this.registerModule=function(n,o){return void 0!==t[n]?void console.warn("Module already registered"):(t.push(n),void o.forEach(function(t){return-1!==r.indexOf(t)?void console.warn("State already registered"):(e.state(t.name,t.state),void r.push(t))}))},this.$get=function(){return r}}function SystemController(e){"use strict";var t=this;t.showingSide=!1,t.showingMenu=!0,t.getAPI=function(t){return e(t)}}function APIFactory(e,t,r,n){"use strict";var o=function i(o){var a=n+o+"/",s=[];this.name=o.charAt(0).toUpperCase()+o.slice(1),this.clearCache=function(){s=[]},this.readAll=function(n){var o=r.defer(),i=n||{};return s&&s[JSON.stringify(i)]&&s[JSON.stringify(i)].timestamp>Date.now()-3e5?(e.debug("up to date cache, using instead"),o.resolve(s[JSON.stringify(i)].rows)):(e.debug("getting fresh data"),t({method:"GET",url:a,params:i}).then(function(e){o.resolve(e.data),s[JSON.stringify(i)]={timestamp:Date.now(),rows:e.data}})),o.promise},this.create=function(e){return t({method:"POST",url:a,data:e})},this.read=function(e){return t({method:"GET",url:a+e})},this.update=function(e){return t({method:"PUT",url:a+e.id,data:e})},this["delete"]=function(e){return t({method:"DELETE",url:a+e.id,data:e})},this.getTableResource=function(t){return function(t){var n,o,a=this,s={};return this.start=0,this.limit=25,Object.defineProperty(this,"order",{get:function(){return n},set:function(t){t!==n&&(e.debug("new order, clearing cache"),n=t,s={})}}),Object.defineProperty(this,"orderBy",{get:function(){return o},set:function(t){t!==o&&(e.debug("new orderby, clearing cache"),o=t,s={})}}),this.get=function(){e.debug(s);var n=r.defer();return void 0!==s[a.limit]&&void 0!==s[a.limit][a.start]?(e.debug(a.limit,a.start,"cached, loading"),n.resolve(s[a.limit][a.start])):(e.debug(a.limit,a.start,"not cached, loading"),i.doTask(t,{start:a.start,limit:a.limit,sort:a.orderBy,dir:a.order}).then(function(e){s[a.limit]=s[a.limit]||{},s[a.limit][a.start]=e,n.resolve(e)},function(e){n.reject(e)})),n.promise},this}(t)}},a={};return function(e){return void 0===a[e]&&(a[e]=new o(e)),a[e]}}function AccountsConfig(e){"use strict";e.registerModule("Accounts",[{showInMenu:!0,menuName:"Accounts",icon:"fa fa-users fa-fw",name:"accounts",priority:0,state:{url:"/accounts",views:{"@":{templateUrl:"modules/accounts/accounts.html",controller:"AccountsController as Accounts"}}}}])}function AccountsController(e,t,r,n){"use strict";function o(){a.total=s.length,i.list=s.slice((a.page-1)*a.perPage,a.page*a.perPage)}var a,i=this,s=[];t.debug(i),n.get("accounts.php").then(function(e){s=e.data,o()});var l=[{header:"Accounts",name:"name",override:function(e,t,r){return'<a href="'+r.account_url+'" target="_blank">'+e+"</a>"}},{name:"account_url",hidden:!0}];i.getAccounts=function(e){var t=e.sort,n=e.sortDirection||"DESC";a=e,s=r("orderBy")(s,t,"DESC"===n),o(),e.gridColumns=l}}function LadderConfig(e){"use strict";e.registerModule("Ladder",[{showInMenu:!0,menuName:"Ladder",icon:"fa fa-bar-chart fa-fw",name:"ladder",priority:0,state:{url:"/",views:{"@":{templateUrl:"modules/ladder/ladder.html",controller:"LadderController as Ladder"}}}}])}function LadderController(e,t,r,n){function o(){var e=r("filter")(s,i.filter);a.total=e.length,i.characters=e.slice((a.page-1)*a.perPage,a.page*a.perPage)}var a,i=this,s=[];e.debug(i),t.get("scraper.php").then(function(e){s=e.data,o()}),t.get("meta.php").then(function(e){i.status=e.data.status,i.lastUpdateTime=e.data.last_ladder_update+"000",i.lastProcessTime=e.data.last_process_time});var l=[{header:"Rank",name:"rank"},{header:"Class",name:"class"},{header:"Level",name:"level"},{header:"Experience",name:"experience"},{header:"Status",name:"status",override:function(e,t,r,n){return"Dead"===e?e:"<status-light status=\"'"+("offline"===e?"danger":"ok")+"'\"></status-light>"}},{header:"Experience gained last hour (Approx.)",name:"experience_last_hour"},{header:"Name",name:"name",override:function(e,t,r){return'<a href="'+r.account_url+'" target="_blank">'+e+"</a>"}},{name:"account_url",hidden:!0}];n.$watch("Ladder.filter",function(e){void 0!==e&&o()}),i.getCharacters=function(e){var t=e.sort||"rank",n=e.sortDirection||"ASC";a=e,"experience"!==t&&"level"!==t||(t=["level","experience"]),s=r("orderBy")(s,t,"DESC"===n),o(),e.gridColumns=l},i.getClassesForRow=function(e){return"Dead"===e.status?"dead":void 0}}function RulesConfig(e){"use strict";e.registerModule("Rules",[{showInMenu:!0,menuName:"Rules",icon:"fa fa-list-ol fa-fw",name:"rules",priority:0,state:{url:"/rules",views:{"@":{templateUrl:"modules/rules/rules.html"}}}}])}function AppConfig(e,t){"use strict";e.otherwise("/"),t.debugEnabled(!0)}GridController.$inject=["$timeout","$log","$scope","$templateRequest","$interpolate"],NavbarController.$inject=["ModuleStates","$state","$http","$window"],SystemController.$inject=["API"],ModuleStatesProvider.$inject=["$stateProvider"],APIFactory.$inject=["$log","$http","$q","APIBaseLocation"],AccountsController.$inject=["System","$log","$filter","$http"],AccountsConfig.$inject=["ModuleStatesProvider"],LadderController.$inject=["$log","$http","$filter","$scope"],LadderConfig.$inject=["ModuleStatesProvider"],RulesConfig.$inject=["ModuleStatesProvider"],AppConfig.$inject=["$urlRouterProvider","$logProvider"],angular.module("mvl.grid",["ui.bootstrap","ngSanitize"]).controller("GridController",GridController).component("grid",{controller:"GridController as Grid",templateUrl:"components/grid/grid.html",bindings:{data:"<",state:"<",getData:"&",columnKey:"@",columnName:"@",autoColumn:"<",pagination:"=?",getClassesForRow:"=",api:"=?"}}).directive("cellValue",["$compile",function(e){"use strict";return function(t,r,n){t.$watch(function(e){return e.$eval(n.cellValue)},function(n){r.html(n),e(r.contents())(t)})}}]),angular.module("poe.navbar",["system","ui.router"]).controller("NavbarController",NavbarController).component("navbar",{controller:"NavbarController as Navbar",templateUrl:"components/navbar/navbar.html"}),angular.module("mvl.statuslight",[]).controller("StatusLightController",StatusLightController).component("statusLight",{controller:"StatusLightController as StatusLight",templateUrl:"components/status-light/status-light.html",bindings:{status:"<"}}),angular.module("system",["ui.router"]).constant("APIBaseLocation","API/").service("System",SystemController).provider("ModuleStates",ModuleStatesProvider).factory("API",APIFactory),angular.module("poe.accounts",["system"]).controller("AccountsController",AccountsController).config(AccountsConfig),angular.module("poe.ladder",["system","ui.bootstrap","mvl.grid","mvl.statuslight"]).controller("LadderController",LadderController).config(LadderConfig).filter("secondsToDateTime",function(){return function(e){if(void 0===e)return e;var t=new Date(0,0,0,0,0,0,0);return t.setSeconds(e),t.getTime()}}),angular.module("poe.rules",[]).config(RulesConfig),angular.module("poeladder",["ui.router","templates","system","poe.navbar","poe.ladder","poe.accounts","poe.rules"]).config(AppConfig);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZ3JpZC9ncmlkLmpzIiwiY29tcG9uZW50cy9uYXZiYXIvbmF2YmFyLmpzIiwiY29tcG9uZW50cy9zdGF0dXMtbGlnaHQvc3RhdHVzLWxpZ2h0LmpzIiwiY29tcG9uZW50cy9zeXN0ZW0vc3lzdGVtLmpzIiwibW9kdWxlcy9hY2NvdW50cy9hY2NvdW50cy5qcyIsIm1vZHVsZXMvbGFkZGVyL2xhZGRlci5qcyIsIm1vZHVsZXMvcnVsZXMvcnVsZXMuanMiLCJhcHAuanMiXSwibmFtZXMiOlsiR3JpZENvbnRyb2xsZXIiLCIkdGltZW91dCIsIiRsb2ciLCIkc2NvcGUiLCIkdGVtcGxhdGVSZXF1ZXN0IiwiJGludGVycG9sYXRlIiwiZ2V0Q29sdW1ucyIsImRhdGEiLCJjb2x1bW5EZWZpbml0aW9uIiwiY29sdW1uS2V5cyIsIm92ZXJyaWRkZW5DZWxscyIsIkFycmF5IiwiaXNBcnJheSIsIkdyaWQiLCJhdXRvQ29sdW1uIiwiZm9yRWFjaCIsInJvdyIsIk9iamVjdCIsImtleXMiLCJjb2x1bW4iLCJoYXNPd25Qcm9wZXJ0eSIsImluZGV4T2YiLCJuZXdDb2x1bW4iLCJjb2x1bW5LZXkiLCJjb2x1bW5OYW1lIiwicHVzaCIsInN0YXRlIiwiZ3JpZENvbHVtbnMiLCJvdmVycmlkZVRlbXBsYXRlIiwidGhlbiIsInJlc3BvbnNlIiwidGVtcGxhdGUiLCJvdmVycmlkZSIsImNlbGwiLCJjZWxsU2NvcGUiLCJlbGVtZW50Iiwicm93SW5kZXhQYWdlIiwiY29sSW5kZXgiLCJsZW5ndGgiLCJyb3dJbmRleCIsInBhZ2UiLCJwZXJQYWdlIiwiJG5ldyIsIiRpbmRleCIsImFuZ3VsYXIiLCJleHRlbmQiLCIkY29sSW5kZXgiLCIkcm93SW5kZXgiLCJkZWZpbmVkQ29sdW1uIiwicHJvcGVydHkiLCJhY3RpdmF0ZSIsInBhZ2luYXRpb24iLCJ1bmRlZmluZWQiLCJzb3J0Iiwic29ydERpcmVjdGlvbiIsInJlZnJlc2giLCJhcGkiLCJsb2ciLCJnZXREYXRhIiwidGhpcyIsIlBhcmVudCIsIiRwYXJlbnQiLCJpc1NvcnRhYmxlIiwic29ydGFibGUiLCJnZXRWYWx1ZSIsIiR3YXRjaCIsInJvd3MiLCJOYXZiYXJDb250cm9sbGVyIiwiTW9kdWxlU3RhdGVzIiwiJHN0YXRlIiwiJGh0dHAiLCIkd2luZG93IiwiTmF2YmFyIiwiaXNBY3RpdmUiLCJtb2R1bGUiLCJpbmNsdWRlcyIsImFjdGl2ZVN0YXRlIiwibmFtZSIsImxvY2FsU3RvcmFnZSIsImFjY291bnROYW1lIiwiZ2V0SXRlbSIsInJlZ2lzdGVyZWQiLCJ1bmRvU3RvcmFnZSIsInNldEl0ZW0iLCJyZWdpc3RlckFjY291bnQiLCJnZXQiLCJTdGF0dXNMaWdodENvbnRyb2xsZXIiLCJTdGF0dXNMaWdodCIsInN0YXR1c1RvQ29sb3IiLCJ1bmtub3duIiwib2siLCJub3RpY2UiLCJ3YXJuaW5nIiwiZGFuZ2VyIiwic3R5bGUiLCJiYWNrZ3JvdW5kLWNvbG9yIiwic3RhdHVzIiwiTW9kdWxlU3RhdGVzUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIm1vZHVsZXMiLCJtb2R1bGVTdGF0ZXMiLCJyZWdpc3Rlck1vZHVsZSIsInN0YXRlcyIsImNvbnNvbGUiLCJ3YXJuIiwiJGdldCIsIlN5c3RlbUNvbnRyb2xsZXIiLCJBUEkiLCJTeXN0ZW0iLCJzaG93aW5nU2lkZSIsInNob3dpbmdNZW51IiwiZ2V0QVBJIiwiQVBJRmFjdG9yeSIsIiRxIiwiQVBJQmFzZUxvY2F0aW9uIiwiYmFzZVVSTCIsImNhY2hlcyIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJjbGVhckNhY2hlIiwicmVhZEFsbCIsImZpbHRlciIsInJlcXVlc3QiLCJkZWZlciIsInBhcmFtcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiZGVidWciLCJyZXNvbHZlIiwibWV0aG9kIiwidXJsIiwicHJvbWlzZSIsImNyZWF0ZSIsIm9iamVjdCIsInJlYWQiLCJpZCIsInVwZGF0ZSIsImdldFRhYmxlUmVzb3VyY2UiLCJ0YXNrIiwib3JkZXIiLCJvcmRlckJ5IiwicmVzb3VyY2UiLCJwYWdpbmF0aW9uQ2FjaGUiLCJzdGFydCIsImxpbWl0IiwiZGVmaW5lUHJvcGVydHkiLCJzZXQiLCJuZXdPcmRlciIsIm5ld09yZGVyQnkiLCJkZWZlcnJlZCIsImRvVGFzayIsImRpciIsInJlYXNvbiIsInJlamVjdCIsIkFQSXMiLCJBY2NvdW50c0NvbmZpZyIsInNob3dJbk1lbnUiLCJtZW51TmFtZSIsImljb24iLCJwcmlvcml0eSIsInZpZXdzIiwiQCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIkFjY291bnRzQ29udHJvbGxlciIsIiRmaWx0ZXIiLCJkb0ZpbHRlciIsImdyaWRTdGF0ZSIsInRvdGFsIiwiYWxsQWNjb3VudHMiLCJBY2NvdW50cyIsImxpc3QiLCJjb2x1bW5zIiwiaGVhZGVyIiwiYWNjb3VudF91cmwiLCJoaWRkZW4iLCJnZXRBY2NvdW50cyIsImRpcmVjdGlvbiIsIkxhZGRlckNvbmZpZyIsIkxhZGRlckNvbnRyb2xsZXIiLCJmaWx0ZXJlZENoYXJhY3RlcnMiLCJhbGxDaGFyYWN0ZXJzIiwiTGFkZGVyIiwiY2hhcmFjdGVycyIsImxhc3RVcGRhdGVUaW1lIiwibGFzdF9sYWRkZXJfdXBkYXRlIiwibGFzdFByb2Nlc3NUaW1lIiwibGFzdF9wcm9jZXNzX3RpbWUiLCJuZXdWYWx1ZSIsImdldENoYXJhY3RlcnMiLCJnZXRDbGFzc2VzRm9yUm93IiwiUnVsZXNDb25maWciLCJBcHBDb25maWciLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkbG9nUHJvdmlkZXIiLCJvdGhlcndpc2UiLCJkZWJ1Z0VuYWJsZWQiLCIkaW5qZWN0IiwiY29tcG9uZW50IiwiYmluZGluZ3MiLCJkaXJlY3RpdmUiLCIkY29tcGlsZSIsInNjb3BlIiwiYXR0cmlidXRlcyIsIiRldmFsIiwiY2VsbFZhbHVlIiwidmFsdWUiLCJodG1sIiwiY29udGVudHMiLCJjb25zdGFudCIsInNlcnZpY2UiLCJwcm92aWRlciIsImZh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LEVBQUE0SyxHQUNBRCxFQUFBN0ksT0FBQSxTQUFBNkksR0FDQSxNQUFBQSxHQUFBRSxNQUFBRCxFQUFBRSxZQUNBLFNBQUFDLEdBQ0EvSyxFQUFBZ0wsS0FBQUQsR0FFQUwsRUFBQTFLLEVBQUFpTCxZQUFBTixTQzNKQWxLLFFBQUE4QixPQUFBLGNBQUEsU0FBQSxjQUNBNkYsV0FBQSxtQkFBQXBHLGtCQUNBdUksVUFBQSxVQUNBbkMsV0FBQSw2QkFDQUQsWUFBQSxrQ0N2QkExSCxRQUFBOEIsT0FBQSxzQkFDQTZGLFdBQUEsd0JBQUFqRix1QkFDQW9ILFVBQUEsZUFDQW5DLFdBQUEsdUNBQ0FELFlBQUEsNENBQ0FxQyxVQUNBM0csT0FBQSxPQzJLQXBELFFBQUE4QixPQUFBLFVBQUEsY0FDQTJJLFNBQUEsa0JBQUEsUUFDQUMsUUFBQSxTQUFBNUcsa0JBQ0E2RyxTQUFBLGVBQUF0SCxzQkFDQXVILFFBQUEsTUFBQXhHLFlDaklBcEUsUUFBQThCLE9BQUEsZ0JBQUEsV0FDQTZGLFdBQUEscUJBQUFDLG9CQUNBaUQsT0FBQTFELGdCQ29EQW5ILFFBQUE4QixPQUFBLGNBQUEsU0FBQSxlQUFBLFdBQUEsb0JBQ0E2RixXQUFBLG1CQUFBZ0Isa0JBQ0FrQyxPQUFBbkMsY0FDQTVELE9BQUEsb0JBQUEsV0FDQSxNQUFBLFVBQUFnRyxHQUNBLEdBQUF0SyxTQUFBc0ssRUFDQSxNQUFBQSxFQUVBLElBQUFDLEdBQUEsR0FBQTFGLE1BQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFFQSxPQURBMEYsR0FBQUMsV0FBQUYsR0FDQUMsRUFBQUUsYUMvR0FqTCxRQUFBOEIsT0FBQSxnQkFDQStJLE9BQUF0QixhQ2hCQXZKLFFBQUE4QixPQUFBLGFBQ0EsWUFDQSxZQUNBLFNBQ0EsYUFDQSxhQUNBLGVBQ0EsY0FFQStJLE9BQUFyQiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBHcmlkQ29udHJvbGxlcigkdGltZW91dCwgJGxvZywgJHNjb3BlLCAkdGVtcGxhdGVSZXF1ZXN0LCAkaW50ZXJwb2xhdGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIEdyaWQgPSB0aGlzO1xuICAgICRzY29wZS5QYXJlbnQgPSAkc2NvcGUuJHBhcmVudDtcblxuICAgIGZ1bmN0aW9uIGdldENvbHVtbnMoZGF0YSkge1xuICAgICAgICB2YXIgY29sdW1uRGVmaW5pdGlvbiA9IFtdLFxuICAgICAgICAgICAgY29sdW1uS2V5cyA9IFtdLFxuICAgICAgICAgICAgb3ZlcnJpZGRlbkNlbGxzID0gW107XG4gICAgICAgIFxuICAgICAgICBpZihBcnJheS5pc0FycmF5KGRhdGEpICYmIEdyaWQuYXV0b0NvbHVtbiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihyb3cpIHtcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhyb3cpLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHJvdy5oYXNPd25Qcm9wZXJ0eShjb2x1bW4pICYmIGNvbHVtbktleXMuaW5kZXhPZihjb2x1bW4pID09PSAtMSAmJiBjb2x1bW4gIT09ICckJGhhc2hLZXknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3Q29sdW1uID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDb2x1bW5bR3JpZC5jb2x1bW5LZXldID0gY29sdW1uO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29sdW1uW0dyaWQuY29sdW1uTmFtZV0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbkRlZmluaXRpb24ucHVzaChuZXdDb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uS2V5cy5wdXNoKGNvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZihHcmlkLnN0YXRlICYmIEFycmF5LmlzQXJyYXkoR3JpZC5zdGF0ZS5ncmlkQ29sdW1ucykpIHtcbiAgICAgICAgICAgIEdyaWQuc3RhdGUuZ3JpZENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgICAgICAgICAgICBpZihjb2x1bW5bR3JpZC5jb2x1bW5LZXldID09PSAnJCRoYXNoS2V5Jykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKGNvbHVtbi5vdmVycmlkZVRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICR0ZW1wbGF0ZVJlcXVlc3QoY29sdW1uLm92ZXJyaWRlVGVtcGxhdGUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9ICRpbnRlcnBvbGF0ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5vdmVycmlkZSA9IGZ1bmN0aW9uKGNlbGwsIGNvbHVtbiwgcm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvd0luZGV4UGFnZSA9IEdyaWQuZGF0YS5pbmRleE9mKHJvdyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gY29sdW1uRGVmaW5pdGlvbi5sZW5ndGggLSAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dJbmRleCA9IChHcmlkLnN0YXRlLnBhZ2UgLSAxKSAqIEdyaWQuc3RhdGUucGVyUGFnZSArIHJvd0luZGV4UGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFNjb3BlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob3ZlcnJpZGRlbkNlbGxzW2NvbHVtbltHcmlkLmNvbHVtbktleV1dICYmIG92ZXJyaWRkZW5DZWxsc1tjb2x1bW5bR3JpZC5jb2x1bW5LZXldXVtyb3dJbmRleFBhZ2VdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvdmVycmlkZGVuQ2VsbHNbY29sdW1uW0dyaWQuY29sdW1uS2V5XV1bcm93SW5kZXhQYWdlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFNjb3BlID0gJHNjb3BlLiRuZXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsU2NvcGUuJGluZGV4ID0gcm93SW5kZXggKyBjZWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGNlbGxTY29wZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sSW5kZXg6IGNvbEluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93SW5kZXg6IHJvd0luZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5kZXg6IHJvd0luZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsOiBjZWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiByb3dcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gdGVtcGxhdGUoY2VsbFNjb3BlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvdmVycmlkZGVuQ2VsbHNbY29sdW1uW0dyaWQuY29sdW1uS2V5XV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGRlbkNlbGxzW2NvbHVtbltHcmlkLmNvbHVtbktleV1dID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRkZW5DZWxsc1tjb2x1bW5bR3JpZC5jb2x1bW5LZXldXVtyb3dJbmRleFBhZ2VdID0gZWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZihjb2x1bW5LZXlzLmluZGV4T2YoY29sdW1uW0dyaWQuY29sdW1uS2V5XSkgPT09IC0xKSB7ICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5EZWZpbml0aW9uLnB1c2goY29sdW1uKTtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uS2V5cy5wdXNoKGNvbHVtbltHcmlkLmNvbHVtbktleV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbkRlZmluaXRpb24uZm9yRWFjaChmdW5jdGlvbihkZWZpbmVkQ29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkZWZpbmVkQ29sdW1uW0dyaWQuY29sdW1uS2V5XSA9PT0gY29sdW1uW0dyaWQuY29sdW1uS2V5XSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGNvbHVtbikuZm9yRWFjaChmdW5jdGlvbihwcm9wZXJ0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZpbmVkQ29sdW1uW3Byb3BlcnR5XSA9IGNvbHVtbltwcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gY29sdW1uRGVmaW5pdGlvbjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgdmFyIHBlclBhZ2UgPSBHcmlkLnBhZ2luYXRpb24gIT09IHRydWUgJiYgR3JpZC5wYWdpbmF0aW9uICE9PSB1bmRlZmluZWQgPyBHcmlkLnBhZ2luYXRpb24gOiAyMDtcbiAgICAgICAgR3JpZC5zdGF0ZSA9IEdyaWQuc3RhdGUgfHwge1xuICAgICAgICAgICAgc29ydDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgc29ydERpcmVjdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICAgIHBlclBhZ2U6IEdyaWQucGFnaW5hdGlvbiAhPT0gZmFsc2UgPyBwZXJQYWdlIDogMCxcbiAgICAgICAgICAgIGdyaWRDb2x1bW5zOiBbXSxcbiAgICAgICAgICAgIHJlZnJlc2g6IGZhbHNlXG4gICAgICAgIH07XG5cbiAgICAgICAgR3JpZC5jb2x1bW5LZXkgPSBHcmlkLmNvbHVtbktleSB8fCAnbmFtZSc7XG4gICAgICAgIEdyaWQuY29sdW1uTmFtZSA9IEdyaWQuY29sdW1uTmFtZSB8fCAnaGVhZGVyJztcbiAgICAgICAgXG4gICAgICAgIEdyaWQuYXBpID0ge1xuICAgICAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5sb2coJ3JlZnJlc2gnKTtcbiAgICAgICAgICAgICAgICBHcmlkLmdldERhdGEoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZTogR3JpZC5zdGF0ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgYWN0aXZhdGUoKTtcbiAgICB9KTtcblxuICAgIEdyaWQuaXNTb3J0YWJsZSA9IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgICAgICByZXR1cm4gY29sdW1uLnNvcnRhYmxlID09PSB1bmRlZmluZWQgPyB0cnVlIDogY29sdW1uLnNvcnRhYmxlO1xuICAgIH07XG4gICAgXG4gICAgR3JpZC5nZXRWYWx1ZSA9IGZ1bmN0aW9uKHJvdywgY29sdW1uLCByb3dJbmRleCkge1xuICAgICAgICB2YXIgY2VsbDtcbiAgICAgICAgaWYoY29sdW1uLm92ZXJyaWRlKSB7XG4gICAgICAgICAgICBjZWxsID0gY29sdW1uLm92ZXJyaWRlKHJvd1tjb2x1bW5bR3JpZC5jb2x1bW5LZXldXSwgY29sdW1uLCByb3csIHJvd0luZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNlbGwgPSByb3dbY29sdW1uW0dyaWQuY29sdW1uS2V5XV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBjZWxsO1xuICAgIH07XG4gICAgXG4gICAgR3JpZC5zb3J0ID0gZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgICAgIGlmKGNvbHVtbi5zb3J0YWJsZSAhPT0gdW5kZWZpbmVkICYmICFjb2x1bW4uc29ydGFibGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYoR3JpZC5zdGF0ZS5zb3J0ID09PSBjb2x1bW5bR3JpZC5jb2x1bW5LZXldKSB7XG4gICAgICAgICAgICBpZihHcmlkLnN0YXRlLnNvcnREaXJlY3Rpb24gPT09ICdERVNDJykge1xuICAgICAgICAgICAgICAgIEdyaWQuc3RhdGUuc29ydERpcmVjdGlvbiA9ICdBU0MnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBHcmlkLnN0YXRlLnNvcnQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgR3JpZC5zdGF0ZS5zb3J0RGlyZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgR3JpZC5zdGF0ZS5zb3J0ID0gY29sdW1uW0dyaWQuY29sdW1uS2V5XTtcbiAgICAgICAgICAgIEdyaWQuc3RhdGUuc29ydERpcmVjdGlvbiA9ICdERVNDJztcbiAgICAgICAgfVxuICAgIH07XG4gICAgICAgIFxuICAgICRzY29wZS4kd2F0Y2goJ0dyaWQuc3RhdGUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoR3JpZC5zdGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBHcmlkLmdldERhdGEoe1xuICAgICAgICAgICAgICAgIHN0YXRlOiBHcmlkLnN0YXRlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sIHRydWUpO1xuICAgIFxuICAgICRzY29wZS4kd2F0Y2goJ0dyaWQuZGF0YScsIGZ1bmN0aW9uKCkge1xuICAgICAgICBHcmlkLmRhdGEgPSBHcmlkLmRhdGEgfHwgW107XG4gICAgICAgIEdyaWQuY29sdW1uRGVmaW5pdGlvbiA9IGdldENvbHVtbnMoR3JpZC5kYXRhKTtcbiAgICAgICAgR3JpZC5yb3dzID0gR3JpZC5kYXRhO1xuICAgIH0sIHRydWUpO1xufVxuXG5hbmd1bGFyLm1vZHVsZSgnbXZsLmdyaWQnLCBbJ3VpLmJvb3RzdHJhcCcsICduZ1Nhbml0aXplJ10pXG4gICAgLmNvbnRyb2xsZXIoJ0dyaWRDb250cm9sbGVyJywgR3JpZENvbnRyb2xsZXIpXG4gICAgLmNvbXBvbmVudCgnZ3JpZCcsIHtcbiAgICAgICAgY29udHJvbGxlcjogJ0dyaWRDb250cm9sbGVyIGFzIEdyaWQnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZ3JpZC9ncmlkLmh0bWwnLFxuICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgZGF0YTogJzwnLFxuICAgICAgICAgICAgc3RhdGU6ICc8JyxcbiAgICAgICAgICAgIGdldERhdGE6ICcmJyxcbiAgICAgICAgICAgIGNvbHVtbktleTogJ0AnLFxuICAgICAgICAgICAgY29sdW1uTmFtZTogJ0AnLFxuICAgICAgICAgICAgYXV0b0NvbHVtbjogJzwnLFxuICAgICAgICAgICAgcGFnaW5hdGlvbjogJz0/JyxcbiAgICAgICAgICAgIGdldENsYXNzZXNGb3JSb3c6ICc9JyxcbiAgICAgICAgICAgIGFwaTogJz0/J1xuICAgICAgICB9XG4gICAgfSlcbiAgICAuZGlyZWN0aXZlKCdjZWxsVmFsdWUnLCBmdW5jdGlvbigkY29tcGlsZSkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChmdW5jdGlvbihzY29wZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kZXZhbChhdHRyaWJ1dGVzLmNlbGxWYWx1ZSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuaHRtbCh2YWx1ZSk7XG4gICAgXG4gICAgICAgICAgICAgICAgJGNvbXBpbGUoZWxlbWVudC5jb250ZW50cygpKShzY29wZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9KTtcbiIsImZ1bmN0aW9uIE5hdmJhckNvbnRyb2xsZXIoTW9kdWxlU3RhdGVzLCAkc3RhdGUsICRodHRwLCAkd2luZG93KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBOYXZiYXIgPSB0aGlzO1xuICAgIFxuICAgIE5hdmJhci5pc0FjdGl2ZSA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuICAgICAgICByZXR1cm4gJHN0YXRlLmluY2x1ZGVzKG1vZHVsZS5hY3RpdmVTdGF0ZSB8fCBtb2R1bGUubmFtZSk7XG4gICAgfTtcbiAgICBcbiAgICBpZigkd2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgICBOYXZiYXIuYWNjb3VudE5hbWUgPSAkd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdyZWdpc3RlcmVkQWNjb3VudCcpO1xuICAgICAgICBpZihOYXZiYXIuYWNjb3VudE5hbWUpIHtcbiAgICAgICAgICAgIE5hdmJhci5yZWdpc3RlcmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBOYXZiYXIudW5kb1N0b3JhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYoJHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlZ2lzdGVyZWRBY2NvdW50JywgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIE5hdmJhci5hY2NvdW50TmFtZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIE5hdmJhci5yZWdpc3RlcmVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFxuICAgIE5hdmJhci5yZWdpc3RlckFjY291bnQgPSBmdW5jdGlvbihhY2NvdW50TmFtZSkge1xuICAgICAgICAkaHR0cC5nZXQoJ2h0dHA6Ly9zc2YucG9lbGFkZGVyLmNvbS9zaWdudXAvJyArIGFjY291bnROYW1lKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgTmF2YmFyLnJlZ2lzdGVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYoJHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdyZWdpc3RlcmVkQWNjb3VudCcsIGFjY291bnROYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBcbiAgICBOYXZiYXIuTW9kdWxlU3RhdGVzID0gTW9kdWxlU3RhdGVzO1xufVxuXG5hbmd1bGFyLm1vZHVsZSgncG9lLm5hdmJhcicsIFsnc3lzdGVtJywgJ3VpLnJvdXRlciddKVxuICAgIC5jb250cm9sbGVyKCdOYXZiYXJDb250cm9sbGVyJywgTmF2YmFyQ29udHJvbGxlcilcbiAgICAuY29tcG9uZW50KCduYXZiYXInLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6ICdOYXZiYXJDb250cm9sbGVyIGFzIE5hdmJhcicsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9uYXZiYXIvbmF2YmFyLmh0bWwnXG4gICAgfSk7IiwiZnVuY3Rpb24gU3RhdHVzTGlnaHRDb250cm9sbGVyKCkge1xuICAgIHZhciBTdGF0dXNMaWdodCA9IHRoaXM7XG4gICAgXG4gICAgdmFyIHN0YXR1c1RvQ29sb3IgPSB7XG4gICAgICAgIHVua25vd246ICcjZWVlJyxcbiAgICAgICAgb2s6ICcjNWNiODVjJyxcbiAgICAgICAgbm90aWNlOiAnI2ZlZmY3OCcsXG4gICAgICAgIHdhcm5pbmc6ICcjZjBhZDRlJyxcbiAgICAgICAgZGFuZ2VyOiAnI2Q5NTM0ZidcbiAgICB9O1xuICAgIFxuICAgIFN0YXR1c0xpZ2h0LnN0eWxlID0ge1xuICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6IHN0YXR1c1RvQ29sb3JbU3RhdHVzTGlnaHQuc3RhdHVzXSB8fCAndHJhbnNwYXJlbnQnXG4gICAgfTtcbn1cblxuYW5ndWxhci5tb2R1bGUoJ212bC5zdGF0dXNsaWdodCcsIFtdKVxuLmNvbnRyb2xsZXIoJ1N0YXR1c0xpZ2h0Q29udHJvbGxlcicsIFN0YXR1c0xpZ2h0Q29udHJvbGxlcilcbi5jb21wb25lbnQoJ3N0YXR1c0xpZ2h0Jywge1xuICAgICAgICBjb250cm9sbGVyOiAnU3RhdHVzTGlnaHRDb250cm9sbGVyIGFzIFN0YXR1c0xpZ2h0JyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3N0YXR1cy1saWdodC9zdGF0dXMtbGlnaHQuaHRtbCcsXG4gICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAnc3RhdHVzJzogJzwnXG4gICAgICAgIH1cbiAgICB9KTsiLCIvKmdsb2JhbCBjb25zb2xlICovXG5mdW5jdGlvbiBNb2R1bGVTdGF0ZXNQcm92aWRlcigkc3RhdGVQcm92aWRlcikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgbW9kdWxlcyA9IFtdLFxuICAgICAgICBtb2R1bGVTdGF0ZXMgPSBbXTtcblxuICAgIHRoaXMucmVnaXN0ZXJNb2R1bGUgPSBmdW5jdGlvbihuYW1lLCBzdGF0ZXMpIHtcbiAgICAgICAgaWYobW9kdWxlc1tuYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ01vZHVsZSBhbHJlYWR5IHJlZ2lzdGVyZWQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbW9kdWxlcy5wdXNoKG5hbWUpO1xuICAgICAgICBcbiAgICAgICAgc3RhdGVzLmZvckVhY2goZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZVN0YXRlcy5pbmRleE9mKHN0YXRlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1N0YXRlIGFscmVhZHkgcmVnaXN0ZXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoc3RhdGUubmFtZSwgc3RhdGUuc3RhdGUpO1xuICAgICAgICAgICAgbW9kdWxlU3RhdGVzLnB1c2goc3RhdGUpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBtb2R1bGVTdGF0ZXM7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gU3lzdGVtQ29udHJvbGxlcihBUEkpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIFN5c3RlbSA9IHRoaXM7XG4gICAgICAgIFxuICAgIFN5c3RlbS5zaG93aW5nU2lkZSA9IGZhbHNlO1xuICAgIFN5c3RlbS5zaG93aW5nTWVudSA9IHRydWU7XG4gICAgXG4gICAgU3lzdGVtLmdldEFQSSA9IGZ1bmN0aW9uIGdldEFQSShuYW1lKSB7XG4gICAgICAgIHJldHVybiBBUEkobmFtZSk7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gQVBJRmFjdG9yeSgkbG9nLCAkaHR0cCwgJHEsIEFQSUJhc2VMb2NhdGlvbikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgQVBJID0gZnVuY3Rpb24gQVBJKG5hbWUpIHtcbiAgICAgICAgdmFyIGJhc2VVUkwgPSBBUElCYXNlTG9jYXRpb24gKyBuYW1lICsgJy8nLFxuICAgICAgICAgICAgY2FjaGVzID0gW107XG4gICAgICAgIFxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zbGljZSgxKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuY2xlYXJDYWNoZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2FjaGVzID0gW107XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJlYWRBbGwgPSBmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gJHEuZGVmZXIoKSxcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBmaWx0ZXIgfHwge307XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKGNhY2hlcyAmJiBjYWNoZXNbSlNPTi5zdHJpbmdpZnkocGFyYW1zKV0gJiYgY2FjaGVzW0pTT04uc3RyaW5naWZ5KHBhcmFtcyldLnRpbWVzdGFtcCA+IERhdGUubm93KCkgLSAxMDAwICogNjAgKiA1KSB7XG4gICAgICAgICAgICAgICAgJGxvZy5kZWJ1ZygndXAgdG8gZGF0ZSBjYWNoZSwgdXNpbmcgaW5zdGVhZCcpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucmVzb2x2ZShjYWNoZXNbSlNPTi5zdHJpbmdpZnkocGFyYW1zKV0ucm93cyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRsb2cuZGVidWcoJ2dldHRpbmcgZnJlc2ggZGF0YScpO1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBiYXNlVVJMLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVzW0pTT04uc3RyaW5naWZ5KHBhcmFtcyldID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcm93czogcmVzcG9uc2UuZGF0YVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdC5wcm9taXNlO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihvYmplY3QpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBiYXNlVVJMLFxuICAgICAgICAgICAgICAgIGRhdGE6IG9iamVjdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJlYWQgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIHVybDogYmFzZVVSTCArIGlkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBiYXNlVVJMICsgb2JqZWN0LmlkLFxuICAgICAgICAgICAgICAgIGRhdGE6IG9iamVjdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB0aGlzLmRlbGV0ZSA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIHVybDogYmFzZVVSTCArIG9iamVjdC5pZCxcbiAgICAgICAgICAgICAgICBkYXRhOiBvYmplY3RcbiAgICAgICAgICAgIH0pOyAgICAgICAgICAgIFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5nZXRUYWJsZVJlc291cmNlID0gZnVuY3Rpb24odGFzaykge1xuICAgICAgICAgICAgcmV0dXJuIChmdW5jdGlvbih0YXNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc291cmNlID0gdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXIsXG4gICAgICAgICAgICAgICAgICAgIG9yZGVyQnksXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25DYWNoZSA9IHt9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMubGltaXQgPSAyNTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ29yZGVyJywge1xuICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKG5ld09yZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihuZXdPcmRlciA9PT0gb3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoJ25ldyBvcmRlciwgY2xlYXJpbmcgY2FjaGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyID0gbmV3T3JkZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ2FjaGUgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnb3JkZXJCeScsIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmRlckJ5O1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKG5ld09yZGVyQnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5ld09yZGVyQnkgPT09IG9yZGVyQnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoJ25ldyBvcmRlcmJ5LCBjbGVhcmluZyBjYWNoZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJCeSA9IG5ld09yZGVyQnk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ2FjaGUgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcocGFnaW5hdGlvbkNhY2hlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmKHBhZ2luYXRpb25DYWNoZVtyZXNvdXJjZS5saW1pdF0gIT09IHVuZGVmaW5lZCAmJiBwYWdpbmF0aW9uQ2FjaGVbcmVzb3VyY2UubGltaXRdW3Jlc291cmNlLnN0YXJ0XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKHJlc291cmNlLmxpbWl0LCByZXNvdXJjZS5zdGFydCwgJ2NhY2hlZCwgbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShwYWdpbmF0aW9uQ2FjaGVbcmVzb3VyY2UubGltaXRdW3Jlc291cmNlLnN0YXJ0XSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9nLmRlYnVnKHJlc291cmNlLmxpbWl0LCByZXNvdXJjZS5zdGFydCwgJ25vdCBjYWNoZWQsIGxvYWRpbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIEFQSS5kb1Rhc2sodGFzaywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiByZXNvdXJjZS5zdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW1pdDogcmVzb3VyY2UubGltaXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydDogcmVzb3VyY2Uub3JkZXJCeSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXI6IHJlc291cmNlLm9yZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ2FjaGVbcmVzb3VyY2UubGltaXRdID0gcGFnaW5hdGlvbkNhY2hlW3Jlc291cmNlLmxpbWl0XSB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ2FjaGVbcmVzb3VyY2UubGltaXRdW3Jlc291cmNlLnN0YXJ0XSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyZWFzb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9KHRhc2spKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIEFQSXMgPSB7fTtcblxuICAgICAgICBcbiAgICByZXR1cm4gZnVuY3Rpb24obmFtZSkge1xuICAgICAgICBpZihBUElzW25hbWVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIEFQSXNbbmFtZV0gPSBuZXcgQVBJKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBBUElzW25hbWVdO1xuICAgIH07XG59XG5cbmFuZ3VsYXIubW9kdWxlKCdzeXN0ZW0nLCBbJ3VpLnJvdXRlciddKVxuICAgIC5jb25zdGFudCgnQVBJQmFzZUxvY2F0aW9uJywgJ0FQSS8nKVxuICAgIC5zZXJ2aWNlKCdTeXN0ZW0nLCBTeXN0ZW1Db250cm9sbGVyKVxuICAgIC5wcm92aWRlcignTW9kdWxlU3RhdGVzJywgTW9kdWxlU3RhdGVzUHJvdmlkZXIpXG4gICAgLmZhY3RvcnkoJ0FQSScsIEFQSUZhY3RvcnkpOyIsImZ1bmN0aW9uIEFjY291bnRzQ29uZmlnKE1vZHVsZVN0YXRlc1Byb3ZpZGVyKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIE1vZHVsZVN0YXRlc1Byb3ZpZGVyLnJlZ2lzdGVyTW9kdWxlKCdBY2NvdW50cycsIFtcbiAgICAgICAge1xuICAgICAgICAgICAgc2hvd0luTWVudTogdHJ1ZSxcbiAgICAgICAgICAgIG1lbnVOYW1lOiAnQWNjb3VudHMnLFxuICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLXVzZXJzIGZhLWZ3JyxcbiAgICAgICAgICAgIG5hbWU6ICdhY2NvdW50cycsXG4gICAgICAgICAgICBwcmlvcml0eTogMCxcbiAgICAgICAgICAgIHN0YXRlOiB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL2FjY291bnRzJyxcbiAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAnQCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hY2NvdW50cy9hY2NvdW50cy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBY2NvdW50c0NvbnRyb2xsZXIgYXMgQWNjb3VudHMnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbn1cblxuZnVuY3Rpb24gQWNjb3VudHNDb250cm9sbGVyKFN5c3RlbSwgJGxvZywgJGZpbHRlciwgJGh0dHApIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIEFjY291bnRzID0gdGhpcztcbiAgICB2YXIgYWxsQWNjb3VudHMgPSBbXTtcbiAgICB2YXIgZ3JpZFN0YXRlO1xuICAgICRsb2cuZGVidWcoQWNjb3VudHMpO1xuICAgIFxuICAgIGZ1bmN0aW9uIGRvRmlsdGVyKCkge1xuICAgICAgICBncmlkU3RhdGUudG90YWwgPSBhbGxBY2NvdW50cy5sZW5ndGg7XG4gICAgICAgIEFjY291bnRzLmxpc3QgPSBhbGxBY2NvdW50cy5zbGljZSgoZ3JpZFN0YXRlLnBhZ2UgLSAxKSAqIGdyaWRTdGF0ZS5wZXJQYWdlLCBncmlkU3RhdGUucGFnZSAqIGdyaWRTdGF0ZS5wZXJQYWdlKTtcbiAgICB9XG4gICAgXG4gICAgJGh0dHAuZ2V0KCdhY2NvdW50cy5waHAnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIGFsbEFjY291bnRzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgZG9GaWx0ZXIoKTtcbiAgICB9KTtcbiAgICBcbiAgICB2YXIgY29sdW1ucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgaGVhZGVyOiAnQWNjb3VudHMnLFxuICAgICAgICAgICAgbmFtZTogJ25hbWUnLFxuICAgICAgICAgICAgb3ZlcnJpZGU6IGZ1bmN0aW9uIChjZWxsLCBjb2x1bW4sIHJvdykge1xuICAgICAgICAgICAgICAgIC8vIGpzaGludCB1bnVzZWQ6ZmFsc2VcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9XCInICsgcm93LmFjY291bnRfdXJsICsgJ1wiIHRhcmdldD1cIl9ibGFua1wiPicgKyBjZWxsICsgJzwvYT4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnYWNjb3VudF91cmwnLFxuICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgIH1cbiAgICBdO1xuICAgIFxuICAgIEFjY291bnRzLmdldEFjY291bnRzID0gZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgICAgdmFyIHNvcnQgPSBzdGF0ZS5zb3J0O1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gc3RhdGUuc29ydERpcmVjdGlvbiB8fCAnREVTQyc7XG4gICAgICAgIFxuICAgICAgICBncmlkU3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgXG4gICAgICAgIGFsbEFjY291bnRzID0gJGZpbHRlcignb3JkZXJCeScpKGFsbEFjY291bnRzLCBzb3J0LCBkaXJlY3Rpb24gPT09ICdERVNDJyk7XG4gICAgICAgIFxuICAgICAgICBkb0ZpbHRlcigpO1xuICAgICAgICBzdGF0ZS5ncmlkQ29sdW1ucyA9IGNvbHVtbnM7XG4gICAgfTtcbn1cblxuYW5ndWxhci5tb2R1bGUoJ3BvZS5hY2NvdW50cycsIFsnc3lzdGVtJ10pXG4gICAgLmNvbnRyb2xsZXIoJ0FjY291bnRzQ29udHJvbGxlcicsIEFjY291bnRzQ29udHJvbGxlcilcbiAgICAuY29uZmlnKEFjY291bnRzQ29uZmlnKTsiLCJmdW5jdGlvbiBMYWRkZXJDb25maWcoTW9kdWxlU3RhdGVzUHJvdmlkZXIpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgTW9kdWxlU3RhdGVzUHJvdmlkZXIucmVnaXN0ZXJNb2R1bGUoJ0xhZGRlcicsIFtcbiAgICAgICAge1xuICAgICAgICAgICAgc2hvd0luTWVudTogdHJ1ZSxcbiAgICAgICAgICAgIG1lbnVOYW1lOiAnTGFkZGVyJyxcbiAgICAgICAgICAgIGljb246ICdmYSBmYS1iYXItY2hhcnQgZmEtZncnLFxuICAgICAgICAgICAgbmFtZTogJ2xhZGRlcicsXG4gICAgICAgICAgICBwcmlvcml0eTogMCxcbiAgICAgICAgICAgIHN0YXRlOiB7XG4gICAgICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0AnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbGFkZGVyL2xhZGRlci5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMYWRkZXJDb250cm9sbGVyIGFzIExhZGRlcidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0pO1xufVxuXG5mdW5jdGlvbiBMYWRkZXJDb250cm9sbGVyKCRsb2csICRodHRwLCAkZmlsdGVyLCAkc2NvcGUpIHtcbiAgICB2YXIgTGFkZGVyID0gdGhpcztcbiAgICB2YXIgYWxsQ2hhcmFjdGVycyA9IFtdO1xuICAgIHZhciBncmlkU3RhdGU7XG4gICAgJGxvZy5kZWJ1ZyhMYWRkZXIpO1xuICAgIFxuICAgIGZ1bmN0aW9uIGRvRmlsdGVyKCkge1xuICAgICAgICB2YXIgZmlsdGVyZWRDaGFyYWN0ZXJzID0gJGZpbHRlcignZmlsdGVyJykoYWxsQ2hhcmFjdGVycywgTGFkZGVyLmZpbHRlcik7XG4gICAgICAgIGdyaWRTdGF0ZS50b3RhbCA9IGZpbHRlcmVkQ2hhcmFjdGVycy5sZW5ndGg7XG4gICAgICAgIExhZGRlci5jaGFyYWN0ZXJzID0gZmlsdGVyZWRDaGFyYWN0ZXJzLnNsaWNlKChncmlkU3RhdGUucGFnZSAtIDEpICogZ3JpZFN0YXRlLnBlclBhZ2UsIGdyaWRTdGF0ZS5wYWdlICogZ3JpZFN0YXRlLnBlclBhZ2UpO1xuICAgIH1cbiAgICBcbiAgICAkaHR0cC5nZXQoJ3NjcmFwZXIucGhwJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBhbGxDaGFyYWN0ZXJzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgZG9GaWx0ZXIoKTtcbiAgICB9KTtcbiAgICBcbiAgICAkaHR0cC5nZXQoJ21ldGEucGhwJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBMYWRkZXIuc3RhdHVzID0gcmVzcG9uc2UuZGF0YS5zdGF0dXM7XG4gICAgICAgIExhZGRlci5sYXN0VXBkYXRlVGltZSA9IHJlc3BvbnNlLmRhdGEubGFzdF9sYWRkZXJfdXBkYXRlICsgJzAwMCc7XG4gICAgICAgIExhZGRlci5sYXN0UHJvY2Vzc1RpbWUgPSByZXNwb25zZS5kYXRhLmxhc3RfcHJvY2Vzc190aW1lO1xuICAgIH0pO1xuICAgIFxuICAgIHZhciBjb2x1bW5zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBoZWFkZXI6ICdSYW5rJyxcbiAgICAgICAgICAgIG5hbWU6ICdyYW5rJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBoZWFkZXI6ICdDbGFzcycsXG4gICAgICAgICAgICBuYW1lOiAnY2xhc3MnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGhlYWRlcjogJ0xldmVsJyxcbiAgICAgICAgICAgIG5hbWU6ICdsZXZlbCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaGVhZGVyOiAnRXhwZXJpZW5jZScsXG4gICAgICAgICAgICBuYW1lOiAnZXhwZXJpZW5jZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaGVhZGVyOiAnU3RhdHVzJyxcbiAgICAgICAgICAgIG5hbWU6ICdzdGF0dXMnLFxuICAgICAgICAgICAgb3ZlcnJpZGU6IGZ1bmN0aW9uKGNlbGwsIGNvbHVtbiwgcm93LCByb3dJbmRleCkge1xuICAgICAgICAgICAgICAgIC8vIGpzaGludCB1bnVzZWQ6ZmFsc2VcbiAgICAgICAgICAgICAgICBpZihjZWxsID09PSAnRGVhZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAnPHN0YXR1cy1saWdodCBzdGF0dXM9XCJcXCcnICsgKGNlbGwgPT09ICdvZmZsaW5lJyA/ICdkYW5nZXInIDogJ29rJykgKyAnXFwnXCI+PC9zdGF0dXMtbGlnaHQ+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgaGVhZGVyOiAnRXhwZXJpZW5jZSBnYWluZWQgbGFzdCBob3VyIChBcHByb3guKScsXG4gICAgICAgICAgICBuYW1lOiAnZXhwZXJpZW5jZV9sYXN0X2hvdXInXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGhlYWRlcjogJ05hbWUnLFxuICAgICAgICAgICAgbmFtZTogJ25hbWUnLFxuICAgICAgICAgICAgb3ZlcnJpZGU6IGZ1bmN0aW9uIChjZWxsLCBjb2x1bW4sIHJvdykge1xuICAgICAgICAgICAgICAgIC8vIGpzaGludCB1bnVzZWQ6ZmFsc2VcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9XCInICsgcm93LmFjY291bnRfdXJsICsgJ1wiIHRhcmdldD1cIl9ibGFua1wiPicgKyBjZWxsICsgJzwvYT4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnYWNjb3VudF91cmwnLFxuICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgIH1cbiAgICBdO1xuICAgIFxuICAgICRzY29wZS4kd2F0Y2goJ0xhZGRlci5maWx0ZXInLCBmdW5jdGlvbihuZXdWYWx1ZSkge1xuICAgICAgICBpZihuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZG9GaWx0ZXIoKTtcbiAgICB9KTtcbiAgICBcbiAgICBMYWRkZXIuZ2V0Q2hhcmFjdGVycyA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICAgIHZhciBzb3J0ID0gc3RhdGUuc29ydCB8fCAncmFuayc7XG4gICAgICAgIHZhciBkaXJlY3Rpb24gPSBzdGF0ZS5zb3J0RGlyZWN0aW9uIHx8ICdBU0MnO1xuICAgICAgICBcbiAgICAgICAgZ3JpZFN0YXRlID0gc3RhdGU7XG4gICAgICAgIFxuICAgICAgICBpZihzb3J0ID09PSAnZXhwZXJpZW5jZScgfHwgc29ydCA9PT0gJ2xldmVsJykge1xuICAgICAgICAgICAgc29ydCA9IFsnbGV2ZWwnLCAnZXhwZXJpZW5jZSddO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBhbGxDaGFyYWN0ZXJzID0gJGZpbHRlcignb3JkZXJCeScpKGFsbENoYXJhY3RlcnMsIHNvcnQsIGRpcmVjdGlvbiA9PT0gJ0RFU0MnKTtcbiAgICAgICAgXG4gICAgICAgIGRvRmlsdGVyKCk7XG4gICAgICAgIHN0YXRlLmdyaWRDb2x1bW5zID0gY29sdW1ucztcbiAgICB9O1xuICAgIFxuICAgIExhZGRlci5nZXRDbGFzc2VzRm9yUm93ID0gZnVuY3Rpb24ocm93KSB7XG4gICAgICAgIGlmKHJvdy5zdGF0dXMgPT09ICdEZWFkJykge1xuICAgICAgICAgICAgcmV0dXJuICdkZWFkJztcbiAgICAgICAgfVxuICAgIH07XG59XG5cbmFuZ3VsYXIubW9kdWxlKCdwb2UubGFkZGVyJywgWydzeXN0ZW0nLCAndWkuYm9vdHN0cmFwJywgJ212bC5ncmlkJywgJ212bC5zdGF0dXNsaWdodCddKVxuICAgIC5jb250cm9sbGVyKCdMYWRkZXJDb250cm9sbGVyJywgTGFkZGVyQ29udHJvbGxlcilcbiAgICAuY29uZmlnKExhZGRlckNvbmZpZylcbiAgICAuZmlsdGVyKCdzZWNvbmRzVG9EYXRlVGltZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2Vjb25kcykge1xuICAgICAgICAgICAgaWYoc2Vjb25kcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlY29uZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKDAsMCwwLDAsMCwwLDApO1xuICAgICAgICAgICAgZC5zZXRTZWNvbmRzKHNlY29uZHMpO1xuICAgICAgICAgICAgcmV0dXJuIGQuZ2V0VGltZSgpO1xuICAgICAgICB9O1xuICAgIH0pOyIsImZ1bmN0aW9uIFJ1bGVzQ29uZmlnKE1vZHVsZVN0YXRlc1Byb3ZpZGVyKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIE1vZHVsZVN0YXRlc1Byb3ZpZGVyLnJlZ2lzdGVyTW9kdWxlKCdSdWxlcycsIFtcbiAgICAgICAge1xuICAgICAgICAgICAgc2hvd0luTWVudTogdHJ1ZSxcbiAgICAgICAgICAgIG1lbnVOYW1lOiAnUnVsZXMnLFxuICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLWxpc3Qtb2wgZmEtZncnLFxuICAgICAgICAgICAgbmFtZTogJ3J1bGVzJyxcbiAgICAgICAgICAgIHByaW9yaXR5OiAwLFxuICAgICAgICAgICAgc3RhdGU6IHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvcnVsZXMnLFxuICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICdAJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3J1bGVzL3J1bGVzLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbn1cblxuYW5ndWxhci5tb2R1bGUoJ3BvZS5ydWxlcycsIFtdKVxuICAgIC5jb25maWcoUnVsZXNDb25maWcpOyIsImZ1bmN0aW9uIEFwcENvbmZpZygkdXJsUm91dGVyUHJvdmlkZXIsICRsb2dQcm92aWRlcikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgJGxvZ1Byb3ZpZGVyLmRlYnVnRW5hYmxlZCh0cnVlKTtcbn1cblxuYW5ndWxhci5tb2R1bGUoJ3BvZWxhZGRlcicsIFtcbiAgICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAgICd0ZW1wbGF0ZXMnLFxuICAgICAgICAnc3lzdGVtJyxcbiAgICAgICAgJ3BvZS5uYXZiYXInLFxuICAgICAgICAncG9lLmxhZGRlcicsXG4gICAgICAgICdwb2UuYWNjb3VudHMnLFxuICAgICAgICAncG9lLnJ1bGVzJ1xuICAgIF0pXG4gICAgLmNvbmZpZyhBcHBDb25maWcpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
